# 智能合约

## 1. 简介

本文档介绍墨群区块链系统中的智能合约系统。用户可使用系统提供的工具集在本地进行区块链合约开发、编译和测试，并发布到KaaS集群中。

### 1.1 智能合约

智能合约是用户和区块链系统进行交互的主要方式。用户通过发布智能合约定义一套逻辑规则。通过调用智能合约中定义的接口，用户可以与该合约进行交互，执行特定的任务或者查询其中保存的数据。区块链的不可篡改性保证这套合约逻辑的正确执行。

### 1.2 墨群区块链系统上的智能合约

墨群区块链中的智能合约系统是一个两层架构，第一层是去中心化应用程序，即DApp（Decentralized Application）。每个DApp下包含智能合约。与一些其他区块链系统不同，墨群链中的DApp以名字区分，同个DApp内的合约也以合约名区分。因此，一个合约的完整名字是"DApp名.合约名"形式。在DApp名明确、或者不重要的情况下，有时也直接以"合约名"指代某个特定合约。

墨群链中的智能合约分为两类，第一类是内置合约。这些合约在系统发布时已经包含在内，统一放在内置DApp "core"之下，提供了包括DApp注册、合约发布在内的一些系统基础功能。内置合约不可动态添加、修改或删除。以下列出了一部分内置合约。

```
core.credit
core.coins
core.dapp
core.contracts
core.deployment
```

第二类合约是用户可以编写并部署到链上的合约。墨群链使用自有的PREDA语言来开发智能合约。

### 1.3 PREDA智能合约

PREDA智能合约具有高效性、确定性、安全性。在语法层面上提供了对分片区块链系统的支持。与诸多其他智能合约语言最大的不同在于，PREDA合约在部署后被直接编译成本地二进制代码，因此无需庞大低效的虚拟机进行解释执行。取而代之的是一个小巧精简的PREDA执行引擎，提供交互服务层与区块链系统进行通信，保证合约的高效执行。

## 2. 开发环境

墨群区块链智能合约开发环境支持包括Windows, Linux和macOS在内的多个操作系统。目前经过测试的系统有

```
Windows 10
Ubuntu 18.04
macOS Catalina
```

以上系统均之支持64位版本。

以下以Windows 10为例。

### 2.1 环境准备

- **Visual Studio Code**。VS Code是微软公司提供的跨平台代码编辑器。用户可到其主页下载对应平台的安装包。
- **Java SE Development Kit**。JDK是Oracle公司提供的Java开发套件。如果用户无需使用Java调用合约，则可跳过此步骤。
- **墨群智能合约开发套件**。其内容包括单机私链环境、PREDA语言VS Code插件和用于和KaaS系统通信的Connector工具。

### 2.2 搭建单机私链环境

### 2.3 安装

### 2.4 配置

## 3. 合约开发

### 3.1 编写合约

### 3.2 编译合约

### 3.3 部署合约

## 4. 测试

### 4.1 PREDA Dev Tool简介

### 4.2 使用Dev Tool调用和测试合约

### 4.3 合约的SDK

## 5. 发布

